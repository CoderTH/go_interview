# 数据库索引
### 什么是索引？

索引是帮助mysql高效获取数据的排好序的数据结构（重点是排好序、数据结构）

### 索引的分类

从数据结构角度出发，索引分为B树索引，B+树索引，哈希索引和位图索引。 在MySQL上，主要是采用B+树索引，B树索引在NoSQL上使用较多，哈希索引在KV数据库上较为常见。

从形态上来说，可以分成覆盖索引，前缀索引，全文索引，联合索引，唯一索引和主键索引。（下面的定义，可以直接一股脑说出来，也可以等面试官问）

* 覆盖索引:其实是指我们查询的列全部命中了索引；

* 前缀索引:是指只利用了数据前几个字符的索引，如果前面几个字符区分度不好的话，不建议使用前缀索引；

* 全文索引:现在比较少用，一般推荐使用别的中间件来完成，例如ES（小心这一步，可能咔嚓把话题引过去了ES上）；

* 联合索引:是指多个列组成一个索引。创建的时候我们会考虑把区分度好的索引放在前面，因为MySQL遵循最左前缀匹配原则；（这里可能会问你啥是最左前缀匹配原则）

* 唯一索引:是指数据库里面要求该索引值必须要唯一，我们一般用于业务唯一性保证；

* 主键索引:是比较特殊的索引，一般它的叶子节点要么存储了数据，要么存储了指向数据的指针。MySQL的innodb引擎存储的是数据，MyISAM放的是数据的地址；（这里也会引过去聚簇索引与非聚簇索引）

从是否存储数据的角度，又可以分为聚簇索引和非聚簇索引，MySQL的主键就是聚簇索引，每张表唯一一个，非聚簇索引的数据本质上存储的是主键。（面试官可能从这里被引导过去聚簇索引与非聚簇索引）

### mysql为什么使用B+树当索引？

1. 与二叉树进行对比：无论是二分搜索树、平衡二叉树、红黑树等，他们都是二叉树，他们都拥有一个共同的缺点，就是他们的节点都只能拥有两个子节点，这种构造就造成当数据量很大的时候他们的树高h会非常大，而在索引查找当中，mysql会将当前查询的节点从磁盘中load到内存当中，这是一次io操作，树越高的话load次数越多，速度越慢。而B+树可以将其理解成多叉树，每一个节点当中有存了许多的小节点，mysql默认给每一个大的节点分配16kb的空间，所以B+树能够在很小的h下储存百万千万数据
2. 与hash进行对比：因为hashtable直接使用hash函数然后寻址操作，所以他的速度看的是比B+树要快的，但是他有一个致命的缺点，hash只适合等量查找例如：==,!=,in。而在关系型数据库中我们会经常使用范围查找，故不使用
3. 与B树对比：b+树其实就是b树的一种变种：
   *  区别：每个节点的大小依旧是mysql默认的16kb，但是b树会将数据存储在每一个节点上面，而B+树只会将数据存储在所有的叶子节点上面
   *  树高：应为每一个大的节点的默认的空间只有16kb，当节点中存储了表数据，那么一个大的节点中存储的索引就会变少，从而造成树变高，io变多
   *  工程化思想：因为b树每一个节点中都存储了数据，所以他的查询时间可能是不可测的，在工程中可能讲究一个结果可预测，选择B+树可能有这方面的考虑

### mysql的索引是存在磁盘当中的吗

确实是存在磁盘当中的，但是其实mysql会把所有的所有的索引load到内存当中方便操作，但是当索引过多，存不下索引时，还是会将索引放在磁盘中，这种情况每次走索引都会触发io，所以不建议设置太多的索引

### 简单介绍一下B+树

![](https://gitee.com/coderth/blogimage/raw/master/img/20210419085150.png)

* 非叶子节点不存储data，只存储索引(冗余)，可以放更多的索引
* 叶子节点包含所有索引字段
* 叶子节点用指针连接，提高区间访问的性能

### 介绍一下为什么叶子节点之间要使用指针连接

主要的原因是为了范围查找的的方便，因为b+树每一层的节点都是有序的，当遇到范围查找时，只需要找到最小值对应的叶子节点，然后通过指针往后找就是了。

### 介绍一下聚集索引与非聚集索引的区别
本质上其实都是B+树，都是叶子节点存储数据，唯一的区别就是：聚集索引的叶子节点中存储所以表数据，而非聚集索引叶子节点存储主键信息或者表数据对应的磁盘地址（非聚集索引可能会有回表操作）

### 什么是联合索引、什么是最左匹配原则

比如说创建了一个（A,B,C）的联合索引，其实就是创建了一个A、（A，B）、（A，B，C）三个索引，他会先对比A如果A相同再去对比B以此类推，所以一般建议将区别度高的字段放在最左边也就是第一个进行判断。这个也就叫最左匹配原则

